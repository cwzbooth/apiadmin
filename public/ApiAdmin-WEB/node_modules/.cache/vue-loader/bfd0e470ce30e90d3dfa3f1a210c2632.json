{"remainingRequest":"/www/wwwroot/apiadmin.fmoons.com/public/ApiAdmin-WEB/node_modules/vue-loader/lib/index.js??vue-loader-options!/www/wwwroot/apiadmin.fmoons.com/public/ApiAdmin-WEB/src/view/interface/group.vue?vue&type=script&lang=js&","dependencies":[{"path":"/www/wwwroot/apiadmin.fmoons.com/public/ApiAdmin-WEB/src/view/interface/group.vue","mtime":1596016298725},{"path":"/www/wwwroot/apiadmin.fmoons.com/public/ApiAdmin-WEB/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/www/wwwroot/apiadmin.fmoons.com/public/ApiAdmin-WEB/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/www/wwwroot/apiadmin.fmoons.com/public/ApiAdmin-WEB/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/www/wwwroot/apiadmin.fmoons.com/public/ApiAdmin-WEB/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { getList, changeStatus, add, edit, del } from '@/api/interface-group'\nimport { baseUrl } from '@/libs/api.request'\nimport { getToken } from '@/libs/util'\nimport { getHash } from '@/api/interface'\n\nconst editButton = (vm, h, currentRow, index) => {\n  if (vm.buttonShow.edit) {\n    return h('Button', {\n      props: {\n        type: 'primary'\n      },\n      style: {\n        margin: '0 5px'\n      },\n      on: {\n        'click': () => {\n          vm.formItem.id = currentRow.id\n          vm.formItem.name = currentRow.name\n          vm.formItem.hash = currentRow.hash\n          vm.formItem.image = currentRow.image\n          vm.formItem.description = currentRow.description\n          vm.modalSetting.show = true\n          vm.modalSetting.index = index\n        }\n      }\n    }, vm.$t('edit_button'))\n  }\n}\nconst deleteButton = (vm, h, currentRow, index) => {\n  if (vm.buttonShow.del) {\n    return h('Poptip', {\n      props: {\n        confirm: true,\n        title: '您确定要删除此接口分组么? 如当前分组下仍有接口，将自动划归于默认分组！',\n        transfer: true\n      },\n      on: {\n        'on-ok': () => {\n          del(currentRow.hash).then(response => {\n            vm.tableData.splice(index, 1)\n            vm.$Message.success(response.data.msg)\n          })\n          currentRow.loading = false\n        }\n      }\n    }, [\n      h('Button', {\n        style: {\n          margin: '0 5px'\n        },\n        props: {\n          type: 'error',\n          placement: 'top',\n          loading: currentRow.isDeleting\n        }\n      }, vm.$t('delete_button'))\n    ])\n  }\n}\n\nexport default {\n  name: 'interface_group',\n  data () {\n    return {\n      uploadUrl: baseUrl + 'Index/upload',\n      uploadHeader: { 'apiAuth': getToken() },\n      columnsList: [\n        {\n          title: '序号',\n          type: 'index',\n          width: 65,\n          align: 'center'\n        },\n        {\n          title: '接口组名称',\n          align: 'center',\n          key: 'name'\n        },\n        {\n          title: '接口组描述',\n          align: 'center',\n          key: 'description'\n        },\n        {\n          title: '接口组热度',\n          align: 'center',\n          width: 120,\n          render: (h, params) => {\n            if (params.row.hot > 10000) {\n              let hot = (parseInt(params.row.hot) / 10000).toFixed(1) + '万'\n              return h('span', hot)\n            } else {\n              return h('span', params.row.hot)\n            }\n          }\n        },\n        {\n          title: '接口组标识',\n          align: 'center',\n          key: 'hash',\n          width: 140\n        },\n        {\n          title: '接口组状态',\n          align: 'center',\n          width: 110,\n          render: (h, params) => {\n            let vm = this\n            return h('i-switch', {\n              attrs: {\n                size: 'large'\n              },\n              props: {\n                'true-value': 1,\n                'false-value': 0,\n                value: params.row.status,\n                disabled: !vm.buttonShow.changeStatus\n              },\n              on: {\n                'on-change': function (status) {\n                  changeStatus(status, params.row.id).then(response => {\n                    vm.$Message.success(response.data.msg)\n                    vm.getList()\n                  })\n                }\n              }\n            }, [\n              h('span', {\n                slot: 'open'\n              }, vm.$t('open_choose')),\n              h('span', {\n                slot: 'close'\n              }, vm.$t('close_choose'))\n            ])\n          }\n        },\n        {\n          title: '操作',\n          align: 'center',\n          width: 200,\n          render: (h, params) => {\n            return h('div', [\n              editButton(this, h, params.row, params.index),\n              deleteButton(this, h, params.row, params.index)\n            ])\n          }\n        }\n      ],\n      tableData: [],\n      tableShow: {\n        currentPage: 1,\n        pageSize: 10,\n        listCount: 0\n      },\n      searchConf: {\n        type: '',\n        keywords: '',\n        status: ''\n      },\n      modalSetting: {\n        show: false,\n        loading: false,\n        index: 0\n      },\n      formItem: {\n        description: '',\n        name: '',\n        hash: '',\n        image: '',\n        id: 0\n      },\n      ruleValidate: {\n        name: [\n          { required: true, message: '接口组名称不能为空', trigger: 'blur' }\n        ]\n      },\n      buttonShow: {\n        edit: true,\n        del: true,\n        changeStatus: true\n      },\n      listLoading: false\n    }\n  },\n  created () {\n    let vm = this\n    vm.getList()\n    vm.hasRule('InterfaceGroup/edit').then(res => {\n      vm.buttonShow.edit = res\n    })\n    vm.hasRule('InterfaceGroup/del').then(res => {\n      vm.buttonShow.del = res\n    })\n    vm.hasRule('InterfaceGroup/changeStatus').then(res => {\n      vm.buttonShow.changeStatus = res\n    })\n  },\n  methods: {\n    alertAdd () {\n      let vm = this\n      getHash().then(response => {\n        vm.formItem.hash = response.data.data.hash\n      })\n      vm.modalSetting.show = true\n    },\n    submit () {\n      let vm = this\n      this.$refs['myForm'].validate((valid) => {\n        if (valid) {\n          vm.modalSetting.loading = true\n          if (vm.formItem.id === 0) {\n            add(vm.formItem).then(response => {\n              vm.$Message.success(response.data.msg)\n              vm.getList()\n              vm.cancel()\n            }).catch(() => {\n              vm.modalSetting.loading = false\n            })\n          } else {\n            edit(vm.formItem).then(response => {\n              vm.$Message.success(response.data.msg)\n              vm.getList()\n              vm.cancel()\n            }).catch(() => {\n              vm.modalSetting.loading = false\n            })\n          }\n        }\n      })\n    },\n    cancel () {\n      this.modalSetting.show = false\n    },\n    changePage (page) {\n      this.tableShow.currentPage = page\n      this.getList()\n    },\n    changeSize (size) {\n      this.tableShow.pageSize = size\n      this.getList()\n    },\n    search () {\n      this.tableShow.currentPage = 1\n      this.getList()\n    },\n    getList () {\n      let vm = this\n      vm.listLoading = true\n      getList({\n        page: vm.tableShow.currentPage,\n        size: vm.tableShow.pageSize,\n        type: vm.searchConf.type,\n        keywords: vm.searchConf.keywords,\n        status: vm.searchConf.status\n      }).then(response => {\n        vm.tableData = response.data.data.list\n        vm.tableShow.listCount = response.data.data.count\n        vm.listLoading = false\n      })\n    },\n    handleImgFormatError (file) {\n      this.$Notice.warning({\n        title: '文件类型不合法',\n        desc: file.name + '的文件类型不正确，请上传jpg或者png图片。'\n      })\n    },\n    handleImgRemove () {\n      this.formItem.image = ''\n    },\n    handleImgSuccess (response) {\n      if (response.code === 1) {\n        this.$Message.success(response.msg)\n        this.formItem.image = response.data.fileUrl\n      } else {\n        this.$Message.error(response.msg)\n      }\n    },\n    handleImgMaxSize (file) {\n      this.$Notice.warning({\n        title: '文件大小不合法',\n        desc: file.name + '太大啦请上传小于5M的文件。'\n      })\n    },\n    doCancel (data) {\n      if (!data) {\n        this.formItem.id = 0\n        this.formItem.image = ''\n        this.$refs['myForm'].resetFields()\n        this.modalSetting.loading = false\n        this.modalSetting.index = 0\n      }\n    }\n  }\n}\n",{"version":3,"sources":["group.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"group.vue","sourceRoot":"src/view/interface","sourcesContent":["<style lang=\"less\" scoped>\n  @import './list.less';\n</style>\n<template>\n  <div>\n    <Row>\n      <Col span=\"24\">\n        <Card class=\"margin-bottom-10\">\n          <Form inline>\n            <FormItem class=\"margin-bottom-0\">\n              <Select v-model=\"searchConf.status\" clearable placeholder='请选择状态' style=\"width:120px\">\n                <Option :value=\"1\">启用</Option>\n                <Option :value=\"0\">禁用</Option>\n              </Select>\n            </FormItem>\n            <FormItem class=\"margin-bottom-0\">\n              <Select v-model=\"searchConf.type\" clearable placeholder=\"请选择类别\" style=\"width:120px\">\n                <Option :value=\"1\">接口组标识</Option>\n                <Option :value=\"2\">接口组名称</Option>\n              </Select>\n            </FormItem>\n            <FormItem class=\"margin-bottom-0\">\n              <Input v-model=\"searchConf.keywords\" placeholder=\"\"></Input>\n            </FormItem>\n            <FormItem class=\"margin-bottom-0\">\n              <Button type=\"primary\" @click=\"search\">{{ $t('find_button') }}/{{ $t('refresh_button') }}</Button>\n            </FormItem>\n          </Form>\n        </Card>\n      </Col>\n    </Row>\n    <Row>\n      <Col span=\"24\">\n        <Card>\n          <div class=\"margin-bottom-15\">\n            <Button type=\"primary\" v-has=\"'InterfaceGroup/add'\" @click=\"alertAdd\" icon=\"md-add\">{{ $t('add_button') }}</Button>\n          </div>\n          <div>\n            <Table :loading=\"listLoading\" :columns=\"columnsList\" :data=\"tableData\" border disabled-hover></Table>\n          </div>\n          <div class=\"margin-top-15\" style=\"text-align: center\">\n            <Page :total=\"tableShow.listCount\" :current=\"tableShow.currentPage\"\n                  :page-size=\"tableShow.pageSize\" @on-change=\"changePage\"\n                  @on-page-size-change=\"changeSize\" show-elevator show-sizer show-total></Page>\n          </div>\n        </Card>\n      </Col>\n    </Row>\n    <Modal v-model=\"modalSetting.show\" width=\"668\" :styles=\"{top: '30px'}\" @on-visible-change=\"doCancel\">\n      <p slot=\"header\" style=\"color:#2d8cf0\">\n        <Icon type=\"md-alert\"></Icon>\n        <span>{{formItem.id ? '编辑' : '新增'}}接口组</span>\n      </p>\n      <Form ref=\"myForm\" :rules=\"ruleValidate\" :model=\"formItem\" :label-width=\"80\">\n        <FormItem label=\"组名称\" prop=\"name\">\n          <Input v-model=\"formItem.name\" placeholder=\"请输入接口组名称\"></Input>\n        </FormItem>\n        <FormItem label=\"组头像\" prop=\"image\">\n          <div class=\"demo-upload-list\" v-if=\"formItem.image\">\n            <img :src=\"formItem.image\">\n            <div class=\"demo-upload-list-cover\">\n              <Icon type=\"ios-trash-outline\" @click.native=\"handleImgRemove()\"></Icon>\n            </div>\n          </div>\n          <input v-if=\"formItem.image\" v-model=\"formItem.image\" type=\"hidden\" name=\"image\">\n          <Upload type=\"drag\"\n                  :action=\"uploadUrl\"\n                  :headers=\"uploadHeader\"\n                  v-if=\"!formItem.image\"\n                  :format=\"['jpg','jpeg','png']\"\n                  :max-size=\"5120\"\n                  :on-success=\"handleImgSuccess\"\n                  :on-format-error=\"handleImgFormatError\"\n                  :on-exceeded-size=\"handleImgMaxSize\"\n                  style=\"display: inline-block;width:58px\">\n            <div style=\"width: 58px;height:58px;line-height: 58px\">\n              <Icon type=\"md-camera\" size=\"20\"></Icon>\n            </div>\n          </Upload>\n        </FormItem>\n        <FormItem label=\"组标识\" prop=\"hash\">\n          <Input style=\"width: 300px\" disabled v-model=\"formItem.hash\"></Input>\n          <Tag color=\"error\" class=\"margin-left-5\">系统自动生成，不允许修改</Tag>\n        </FormItem>\n        <FormItem label=\"组描述\" prop=\"description\">\n          <Input v-model=\"formItem.description\" :autosize=\"{maxRows: 10, minRows: 4}\" type=\"textarea\"\n                 placeholder=\"请输入接口组描述\"></Input>\n        </FormItem>\n      </Form>\n      <div slot=\"footer\">\n        <Button type=\"text\" @click=\"cancel\" class=\"margin-right-10\">取消</Button>\n        <Button type=\"primary\" @click=\"submit\" :loading=\"modalSetting.loading\">确定</Button>\n      </div>\n    </Modal>\n  </div>\n</template>\n<script>\nimport { getList, changeStatus, add, edit, del } from '@/api/interface-group'\nimport { baseUrl } from '@/libs/api.request'\nimport { getToken } from '@/libs/util'\nimport { getHash } from '@/api/interface'\n\nconst editButton = (vm, h, currentRow, index) => {\n  if (vm.buttonShow.edit) {\n    return h('Button', {\n      props: {\n        type: 'primary'\n      },\n      style: {\n        margin: '0 5px'\n      },\n      on: {\n        'click': () => {\n          vm.formItem.id = currentRow.id\n          vm.formItem.name = currentRow.name\n          vm.formItem.hash = currentRow.hash\n          vm.formItem.image = currentRow.image\n          vm.formItem.description = currentRow.description\n          vm.modalSetting.show = true\n          vm.modalSetting.index = index\n        }\n      }\n    }, vm.$t('edit_button'))\n  }\n}\nconst deleteButton = (vm, h, currentRow, index) => {\n  if (vm.buttonShow.del) {\n    return h('Poptip', {\n      props: {\n        confirm: true,\n        title: '您确定要删除此接口分组么? 如当前分组下仍有接口，将自动划归于默认分组！',\n        transfer: true\n      },\n      on: {\n        'on-ok': () => {\n          del(currentRow.hash).then(response => {\n            vm.tableData.splice(index, 1)\n            vm.$Message.success(response.data.msg)\n          })\n          currentRow.loading = false\n        }\n      }\n    }, [\n      h('Button', {\n        style: {\n          margin: '0 5px'\n        },\n        props: {\n          type: 'error',\n          placement: 'top',\n          loading: currentRow.isDeleting\n        }\n      }, vm.$t('delete_button'))\n    ])\n  }\n}\n\nexport default {\n  name: 'interface_group',\n  data () {\n    return {\n      uploadUrl: baseUrl + 'Index/upload',\n      uploadHeader: { 'apiAuth': getToken() },\n      columnsList: [\n        {\n          title: '序号',\n          type: 'index',\n          width: 65,\n          align: 'center'\n        },\n        {\n          title: '接口组名称',\n          align: 'center',\n          key: 'name'\n        },\n        {\n          title: '接口组描述',\n          align: 'center',\n          key: 'description'\n        },\n        {\n          title: '接口组热度',\n          align: 'center',\n          width: 120,\n          render: (h, params) => {\n            if (params.row.hot > 10000) {\n              let hot = (parseInt(params.row.hot) / 10000).toFixed(1) + '万'\n              return h('span', hot)\n            } else {\n              return h('span', params.row.hot)\n            }\n          }\n        },\n        {\n          title: '接口组标识',\n          align: 'center',\n          key: 'hash',\n          width: 140\n        },\n        {\n          title: '接口组状态',\n          align: 'center',\n          width: 110,\n          render: (h, params) => {\n            let vm = this\n            return h('i-switch', {\n              attrs: {\n                size: 'large'\n              },\n              props: {\n                'true-value': 1,\n                'false-value': 0,\n                value: params.row.status,\n                disabled: !vm.buttonShow.changeStatus\n              },\n              on: {\n                'on-change': function (status) {\n                  changeStatus(status, params.row.id).then(response => {\n                    vm.$Message.success(response.data.msg)\n                    vm.getList()\n                  })\n                }\n              }\n            }, [\n              h('span', {\n                slot: 'open'\n              }, vm.$t('open_choose')),\n              h('span', {\n                slot: 'close'\n              }, vm.$t('close_choose'))\n            ])\n          }\n        },\n        {\n          title: '操作',\n          align: 'center',\n          width: 200,\n          render: (h, params) => {\n            return h('div', [\n              editButton(this, h, params.row, params.index),\n              deleteButton(this, h, params.row, params.index)\n            ])\n          }\n        }\n      ],\n      tableData: [],\n      tableShow: {\n        currentPage: 1,\n        pageSize: 10,\n        listCount: 0\n      },\n      searchConf: {\n        type: '',\n        keywords: '',\n        status: ''\n      },\n      modalSetting: {\n        show: false,\n        loading: false,\n        index: 0\n      },\n      formItem: {\n        description: '',\n        name: '',\n        hash: '',\n        image: '',\n        id: 0\n      },\n      ruleValidate: {\n        name: [\n          { required: true, message: '接口组名称不能为空', trigger: 'blur' }\n        ]\n      },\n      buttonShow: {\n        edit: true,\n        del: true,\n        changeStatus: true\n      },\n      listLoading: false\n    }\n  },\n  created () {\n    let vm = this\n    vm.getList()\n    vm.hasRule('InterfaceGroup/edit').then(res => {\n      vm.buttonShow.edit = res\n    })\n    vm.hasRule('InterfaceGroup/del').then(res => {\n      vm.buttonShow.del = res\n    })\n    vm.hasRule('InterfaceGroup/changeStatus').then(res => {\n      vm.buttonShow.changeStatus = res\n    })\n  },\n  methods: {\n    alertAdd () {\n      let vm = this\n      getHash().then(response => {\n        vm.formItem.hash = response.data.data.hash\n      })\n      vm.modalSetting.show = true\n    },\n    submit () {\n      let vm = this\n      this.$refs['myForm'].validate((valid) => {\n        if (valid) {\n          vm.modalSetting.loading = true\n          if (vm.formItem.id === 0) {\n            add(vm.formItem).then(response => {\n              vm.$Message.success(response.data.msg)\n              vm.getList()\n              vm.cancel()\n            }).catch(() => {\n              vm.modalSetting.loading = false\n            })\n          } else {\n            edit(vm.formItem).then(response => {\n              vm.$Message.success(response.data.msg)\n              vm.getList()\n              vm.cancel()\n            }).catch(() => {\n              vm.modalSetting.loading = false\n            })\n          }\n        }\n      })\n    },\n    cancel () {\n      this.modalSetting.show = false\n    },\n    changePage (page) {\n      this.tableShow.currentPage = page\n      this.getList()\n    },\n    changeSize (size) {\n      this.tableShow.pageSize = size\n      this.getList()\n    },\n    search () {\n      this.tableShow.currentPage = 1\n      this.getList()\n    },\n    getList () {\n      let vm = this\n      vm.listLoading = true\n      getList({\n        page: vm.tableShow.currentPage,\n        size: vm.tableShow.pageSize,\n        type: vm.searchConf.type,\n        keywords: vm.searchConf.keywords,\n        status: vm.searchConf.status\n      }).then(response => {\n        vm.tableData = response.data.data.list\n        vm.tableShow.listCount = response.data.data.count\n        vm.listLoading = false\n      })\n    },\n    handleImgFormatError (file) {\n      this.$Notice.warning({\n        title: '文件类型不合法',\n        desc: file.name + '的文件类型不正确，请上传jpg或者png图片。'\n      })\n    },\n    handleImgRemove () {\n      this.formItem.image = ''\n    },\n    handleImgSuccess (response) {\n      if (response.code === 1) {\n        this.$Message.success(response.msg)\n        this.formItem.image = response.data.fileUrl\n      } else {\n        this.$Message.error(response.msg)\n      }\n    },\n    handleImgMaxSize (file) {\n      this.$Notice.warning({\n        title: '文件大小不合法',\n        desc: file.name + '太大啦请上传小于5M的文件。'\n      })\n    },\n    doCancel (data) {\n      if (!data) {\n        this.formItem.id = 0\n        this.formItem.image = ''\n        this.$refs['myForm'].resetFields()\n        this.modalSetting.loading = false\n        this.modalSetting.index = 0\n      }\n    }\n  }\n}\n</script>\n"]}]}